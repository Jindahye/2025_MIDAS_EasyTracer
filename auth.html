<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>로그인 · 회원가입 - Easy Tracer</title>
  <link rel="stylesheet" href="assets/CSS/style.css" />
  <style>
    .auth-wrapper {
      max-width: 420px;
      margin: 60px auto;
    }

    .auth-card {
      background-color: #ffffff;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
      padding: 24px 24px 28px;
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 20px;
      border-radius: 999px;
      background-color: #f3f4f6;
      padding: 4px;
    }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 8px 0;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
      color: #6b7280;
    }

    .auth-tab.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #ffffff;
      font-weight: 600;
      box-shadow: 0 6px 15px rgba(56, 189, 248, 0.35);
    }

    .auth-title {
      margin: 0 0 4px;
      font-size: 22px;
      font-weight: 700;
    }

    .auth-sub {
      margin: 0 0 18px;
      font-size: 13px;
      color: var(--text-sub);
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .auth-label {
      font-size: 13px;
      margin-bottom: 4px;
    }

    .auth-input {
      width: 100%;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      font-size: 14px;
      outline: none;
    }

    .auth-input:focus {
      border-color: var(--primary-dark);
      box-shadow: 0 0 0 1px var(--primary-soft);
    }

    .auth-btn {
      width: 100%;
      text-align: center;
      margin-top: 8px;
    }

    .auth-message {
      margin-top: 10px;
      font-size: 13px;
      min-height: 18px;
    }

    .auth-message.error {
      color: #ef4444;
    }

    .auth-message.success {
      color: #16a34a;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container nav">
      <div class="logo">
        <img
          src="assets/img/easy-tracer-icon.png"
          alt="Easy Tracer 아이콘"
          class="logo-icon"
        />
        Easy Tracer
      </div>
      <nav>
        <a href="index.html">홈</a>
        <a href="#">문제 목록</a>
        <a href="#">랭킹</a>
        <a href="#">커뮤니티</a>
        <a href="auth.html" class="btn-primary nav-mypage">로그인</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="auth-wrapper">
      <div class="auth-card">
        <div class="auth-tabs">
          <div class="auth-tab active" data-mode="login">로그인</div>
          <div class="auth-tab" data-mode="signup">회원가입</div>
        </div>

        <h1 class="auth-title" id="auth-title">로그인</h1>
        <p class="auth-sub" id="auth-sub">
          Easy Tracer 계정으로 라인트레이서 문제를 풀고 기록을 저장해보세요.
        </p>

        <form class="auth-form" id="auth-form">
          <div>
            <div class="auth-label">아이디 / 이메일</div>
            <input
              type="text"
              id="auth-username"
              class="auth-input"
              required
              autocomplete="username"
            />
          </div>
          <div>
            <div class="auth-label">비밀번호</div>
            <input
              type="password"
              id="auth-password"
              class="auth-input"
              required
              autocomplete="current-password"
            />
          </div>

          <button type="submit" class="btn-primary auth-btn" id="auth-submit-btn">
            로그인
          </button>

          <div id="auth-message" class="auth-message"></div>
        </form>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      © 2025 Easy Tracer. All rights reserved.
    </div>
  </footer>

  <!-- 여기서 우리가 만든 api.js 사용 -->
  <script src="assets/JS/api.js"></script>
  <script>
    const tabs = document.querySelectorAll(".auth-tab");
    const titleEl = document.getElementById("auth-title");
    const subEl = document.getElementById("auth-sub");
    const formEl = document.getElementById("auth-form");
    const usernameEl = document.getElementById("auth-username");
    const passwordEl = document.getElementById("auth-password");
    const messageEl = document.getElementById("auth-message");
    const submitBtn = document.getElementById("auth-submit-btn");

    let mode = "login"; // 또는 "signup"

    function setMode(newMode) {
      mode = newMode;
      tabs.forEach((tab) => {
        tab.classList.toggle("active", tab.dataset.mode === mode);
      });

      if (mode === "login") {
        titleEl.textContent = "로그인";
        subEl.textContent =
          "Easy Tracer 계정으로 라인트레이서 문제를 풀고 기록을 저장해보세요.";
        submitBtn.textContent = "로그인";
      } else {
        titleEl.textContent = "회원가입";
        subEl.textContent =
          "아이디와 비밀번호를 설정해서 Easy Tracer 계정을 만들어보세요.";
        submitBtn.textContent = "회원가입";
      }

      messageEl.textContent = "";
      messageEl.className = "auth-message";
    }

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        setMode(tab.dataset.mode);
      });
    });

    formEl.addEventListener("submit", async (e) => {
      e.preventDefault();
      messageEl.textContent = "";
      messageEl.className = "auth-message";

      const username = usernameEl.value.trim();
      const password = passwordEl.value;

      if (!username || !password) {
        messageEl.textContent = "아이디와 비밀번호를 입력해 주세요.";
        messageEl.classList.add("error");
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = mode === "login" ? "로그인 중..." : "회원가입 중...";

      try {
        if (mode === "login") {
          await window.easyTracerApi.login(username, password);
          messageEl.textContent = "로그인 성공! 메인 페이지로 이동합니다.";
          messageEl.classList.add("success");

          setTimeout(() => {
            window.location.href = "index.html";
          }, 700);
        } else {
          await window.easyTracerApi.signup(username, password);
          messageEl.textContent = "회원가입 성공! 이제 로그인해 주세요.";
          messageEl.classList.add("success");
          setMode("login");
        }
      } catch (err) {
        messageEl.textContent = err.message || "오류가 발생했어요.";
        messageEl.classList.add("error");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = mode === "login" ? "로그인" : "회원가입";
      }
    });
  </script>
</body>
</html>
